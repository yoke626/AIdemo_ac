<!--<!DOCTYPE html>-->
<!--<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security" lang="zh">-->
<!--<head>-->
<!--    <meta charset="UTF-8">-->
<!--    <title>知识库管理</title>-->
<!--    <style>-->
<!--        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; margin: 2em; background-color: #f9f9f9; color: #333; }-->
<!--        .container { max-width: 960px; margin: auto; background: #fff; padding: 2em; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }-->
<!--        h1, h2 { color: #2c3e50; border-bottom: 2px solid #3498db; padding-bottom: 10px; }-->
<!--        table { width: 100%; border-collapse: collapse; margin-top: 20px; }-->
<!--        th, td { border: 1px solid #ddd; padding: 12px; text-align: left; }-->
<!--        th { background-color: #f2f2f2; font-weight: bold; }-->
<!--        tr:nth-child(even) { background-color: #f9f9f9; }-->
<!--        a { text-decoration: none; color: #3498db; }-->
<!--        a:hover { text-decoration: underline; }-->
<!--        button { border: none; padding: 8px 15px; background-color: #2ecc71; color: white; border-radius: 5px; cursor: pointer; font-size: 14px; }-->
<!--        button:hover { opacity: 0.9; }-->
<!--        .admin-form { background-color: #fdfdfd; border: 1px solid #eee; padding: 20px; border-radius: 5px; margin-top: 15px; }-->
<!--        .admin-form div { margin-bottom: 15px; }-->
<!--        .admin-form label { font-weight: bold; display: block; margin-bottom: 5px; }-->
<!--        .admin-form input, .admin-form textarea { width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; }-->
<!--    </style>-->
<!--</head>-->
<!--<body>-->
<!--<div class="container">-->
<!--    <h1>知识库管理</h1>-->
<!--    <a th:href="@{/chat}">返回聊天</a>-->

<!--    <div sec:authorize="hasRole('ADMIN')">-->
<!--        <h2>新增知识条目</h2>-->
<!--        <div class="admin-form">-->
<!--            <form th:action="@{/knowledge/add}" th:object="${newKnowledge}" method="post">-->
<!--                <div>-->
<!--                    <label for="question">问题/关键词:</label>-->
<!--                    <input type="text" id="question" th:field="*{question}" required/>-->
<!--                </div>-->
<!--                <div>-->
<!--                    <label for="answer">答案:</label>-->
<!--                    <textarea id="answer" th:field="*{answer}" rows="4" required></textarea>-->
<!--                </div>-->
<!--                <button type="submit">添加到知识库</button>-->
<!--            </form>-->
<!--        </div>-->
<!--    </div>-->

<!--    <h2>所有条目</h2>-->
<!--    <table>-->
<!--        <thead>-->
<!--        <tr>-->
<!--            <th>问题/关键词</th>-->
<!--            <th>答案</th>-->
<!--        </tr>-->
<!--        </thead>-->
<!--        <tbody>-->
<!--        <tr th:if="${knowledgeList.isEmpty()}">-->
<!--            <td colspan="2" style="text-align: center;">知识库中还没有任何内容。</td>-->
<!--        </tr>-->
<!--        <tr th:each="k : ${knowledgeList}">-->
<!--            <td th:text="${k.question}"></td>-->
<!--            <td th:text="${k.answer}"></td>-->
<!--        </tr>-->
<!--        </tbody>-->
<!--    </table>-->
<!--</div>-->
<!--</body>-->
<!--</html>-->

<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security" lang="zh">
<head>
    <meta charset="UTF-8">
    <title>知识库管理</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; margin: 2em; background-color: #f9f9f9; color: #333; }
        .container { max-width: 960px; margin: auto; background: #fff; padding: 2em; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        h1, h2 { color: #2c3e50; border-bottom: 2px solid #3498db; padding-bottom: 10px; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #ddd; padding: 12px; text-align: left; word-break: break-word; }
        th { background-color: #f2f2f2; font-weight: bold; }
        tr:nth-child(even) { background-color: #f9f9f9; }
        a { text-decoration: none; color: #3498db; }
        a:hover { text-decoration: underline; }
        button { border: none; padding: 8px 15px; background-color: #2ecc71; color: white; border-radius: 5px; cursor: pointer; font-size: 14px; }
        button:hover { opacity: 0.9; }
        .top-nav { margin-bottom: 20px; padding-bottom: 20px; border-bottom: 1px solid #eee; }
        .admin-section { background-color: #fdfdfd; border: 1px solid #eee; padding: 20px; border-radius: 5px; margin-top: 15px; }
        .admin-section div { margin-bottom: 15px; }
        .admin-section label { font-weight: bold; display: block; margin-bottom: 5px; }
        .admin-section input, .admin-section textarea { width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; }
        .message { padding: 10px; margin-top:10px; border-radius: 4px; font-weight: bold; }
        .message.success { color: #270; background-color: #DFF2BF; }
    </style>
</head>
<body>
<div class="container">
    <div class="top-nav">
        <h1>知识库管理</h1>
        <a th:href="@{/chat}">返回聊天</a> |
        <a th:href="@{/history}">查看问答历史</a> |
        <form th:action="@{/logout}" method="post" style="display:inline; margin-left: 10px;">
            <button type="submit" style="background:none; border:none; color:#e74c3c; padding:0; cursor:pointer; font-size: 1em;">注销</button>
        </form>
    </div>

    <div th:if="${message}" th:text="${message}" class="message success"></div>

    <div sec:authorize="hasRole('ADMIN')">
        <h2>新增/更新知识</h2>

        <div class="admin-section">
            <h3>手动新增条目</h3>
            <form th:action="@{/knowledge/add}" th:object="${newKnowledge}" method="post" enctype="multipart/form-data">
                <div>
                    <label for="question">问题/关键词:</label>
                    <input type="text" id="question" th:field="*{question}" required/>
                </div>
                <div>
                    <label for="answer">答案:</label>
                    <textarea id="answer" th:field="*{answer}" rows="4" required></textarea>
                </div>
                <div>
                    <label for="imageFile">相关图片 (可选):</label>
                    <input type="file" id="imageFile" name="imageFile" accept="image/*"/>
                </div>
                <button type="submit">添加到知识库</button>
            </form>
        </div>

        <div class="admin-section" style="margin-top: 20px;">
            <h3>从文件批量上传 (格式: 问题,答案 / 每行一条)</h3>
            <form th:action="@{/knowledge/upload}" method="post" enctype="multipart/form-data">
                <input type="file" name="file" accept=".txt,.csv" required/>
                <button type="submit">上传文件</button>
            </form>
        </div>
        <hr>
    </div>

    <h2>所有条目</h2>
    <table>
        <thead>
        <tr>
            <th>问题/关键词</th>
            <th>答案</th>
            <th>相关图片</th>
        </tr>
        </thead>
        <tbody>
        <tr th:if="${knowledgeList.isEmpty()}">
            <td colspan="3" style="text-align: center;">知识库中还没有任何内容。</td>
        </tr>
        <tr th:each="k : ${knowledgeList}">
            <td th:text="${k.question}"></td>
            <td th:text="${k.answer}"></td>
            <td>
                <img th:if="${k.imageUrl}" th:src="@{${k.imageUrl}}" alt="知识图片" width="150"/>
                <span th:unless="${k.imageUrl}">无</span>
            </td>
        </tr>
        </tbody>
    </table>
</div>
</body>
</html>